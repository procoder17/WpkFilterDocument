(()=>{function e(e,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var n=window.jQuery,s=function(){function s(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,s);var e=this;e.cache={},e.pendingAjax=!1,e.xhrAjaxSearch=!1,e.$body=n("body"),e.$window=n(window),e.$document=n(document),e.$preloader=n('<div class="docspress-preloader"><span><span></span></span></div>'),e.$singleAjax=n(".docspress-single-ajax"),e.initSearch(),e.initAnchors(),e.initFeedbacks(),e.initAjax()}var o,t;return o=s,(t=[{key:"stripHash",value:function(e){return e.replace(/#.*/,"")}},{key:"initSearch",value:function(){var e=this,s=!1;e.$document.on("submit",".docspress-search-form",(function(s){s.preventDefault(),e.prepareSearchResults(n(this))})),e.$document.on("input",".docspress-search-form",(function(o){var t=this;o.preventDefault(),clearTimeout(s),s=setTimeout((function(){e.prepareSearchResults(n(t))}),500)}))}},{key:"prepareSearchResults",value:function(e){var s=this;s.xhrAjaxSearch&&s.xhrAjaxSearch.abort(),e.find(".docspress-search-field").val()?s.xhrAjaxSearch=n.ajax({type:"GET",url:e.attr("action"),data:e.serialize(),success:function(o){var t=n(o).find(".docspress-search-list").get(0).outerHTML;e.next(".docspress-search-form-result").html(t),s.xhrAjaxSearch=!1},error:function(e){console.log(e),s.xhrAjaxSearch=!1}}):e.next(".docspress-search-form-result").html("")}},{key:"initAnchors",value:function(){var e=!!window.AnchorJS&&new window.AnchorJS;e&&(e.options={placement:"right",visible:"hover",icon:"#"},e.add(".docspress-single-content .entry-content h2, .docspress-single-content .entry-content h3, .docspress-single-content .entry-content h4"))}},{key:"initFeedbacks",value:function(){var e=this;e.$body.on("click",".docspress-single-feedback a",(function(s){e.onFeedbackClick(s,n(this))})),e.$body.on("submit",".docspress-single-feedback + .docspress-single-feedback-suggestion",(function(s){e.onFeedbackSuggestionSend(s,n(this))}))}},{key:"initAjax",value:function(){var e=this;e.$singleAjax.length&&(e.setCache(window.location.href,{href:window.location.href,title:document.title,doc:e.$singleAjax.html(),html:document.documentElement.outerHTML}),e.$singleAjax.on("click",".docspress-nav-list a, .docspress-single-breadcrumbs a, .docspress-single-articles a, .docspress-single-adjacent-nav a, .docspress-search-form-result a",(function(n){e.onDocLinksClick(n)})),e.$window.on("popstate",(function(n){e.renderDoc(n.target.location.href)})))}},{key:"onFeedbackClick",value:function(e,s){e.preventDefault();var o=this;if(!o.pendingAjax){o.pendingAjax=!0;var t=s.closest(".docspress-single-feedback").addClass("docspress-single-feedback-loading"),a=s.closest(".docspress-single-content").find(".docspress-single-feedback-suggestion"),i=s.data("type"),r={post_id:s.data("id"),type:i,action:"docspress_ajax_feedback",_wpnonce:window.docspress_vars.nonce};t.append(o.$preloader.clone()),n.post(window.docspress_vars.ajaxurl,r,(function(e){t.html("<div>"+e.data+"</div>"),e.success&&a.length&&(a.show(),a.append('<input type="hidden" name="feedback_type" value="'.concat(i,'">'))),t.removeClass("docspress-single-feedback-loading"),o.pendingAjax=!1}))}}},{key:"onFeedbackSuggestionSend",value:function(e,s){e.preventDefault();var o=this;if(!o.pendingAjax){o.pendingAjax=!0;var t=s.closest(".docspress-single-feedback-suggestion").addClass("docspress-single-feedback-suggestion-loading"),a=s.find("button"),i=s.serializeArray().reduce((function(e,n){return e[n.name]=n.value,e}),{}),r={post_id:i.id,from:i.from,suggestion:i.suggestion,feedback_type:i.feedback_type,action:"docspress_ajax_feedback_suggestion",_wpnonce:window.docspress_vars.nonce};t.append(o.$preloader.clone()),a.prop("disabled","disabled"),n.post(window.docspress_vars.ajaxurl,r,(function(e){t.html("<div>"+e.data+"</div>").removeClass("docspress-single-feedback-suggestion-loading"),o.pendingAjax=!1}))}}},{key:"setCache",value:function(e,n){n=n||!1,(e=e||!1)&&n&&!this.cache[e]&&(this.cache[e]=n)}},{key:"getCache",value:function(e){return!(!(e=e||!1)||!this.cache[e])&&this.cache[e]}},{key:"renderDoc",value:function(e){var s=this.getCache(e);this.$singleAjax.html(s.doc),n("title").text(s.title),n(".wp-admin-bar-edit .ab-item").attr("href",e);var o=n(".docspress-single")[0].getBoundingClientRect().top;o<0&&this.$document.scrollTop(this.$document.scrollTop()+o),this.initAnchors(),this.$document.trigger("docspress_ajax_loaded",s)}},{key:"onDocLinksClick",value:function(e){var n=e.currentTarget;e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||window.location.protocol===n.protocol&&window.location.hostname===n.hostname&&(n.href.indexOf("#")>-1&&this.stripHash(n.href)===this.stripHash(window.location.href)||"file:"!==window.location.protocol&&(e.isDefaultPrevented()||(e.preventDefault(),this.loadDocPage(n.href))))}},{key:"loadDocPage",value:function(e){var s=this;if((e=e||!1)&&s.stripHash(e)!==s.stripHash(window.location.href)){var o=s.getCache(e);if(o)return s.renderDoc(e),void window.history.pushState(null,o.title,e);s.xhr&&s.xhr.abort&&(s.xhr.abort(),s.xhr={});var t=s.$singleAjax.addClass("docspress-single-ajax-loading");t.find(".docspress-single-content").append(s.$preloader.clone()),s.xhr=n.ajax({url:e,success:function(o){if(o){var a=n("<div>").html(o),i=a.find("title:eq(0)").text()||document.title,r=a.find(".docspress-single-ajax").html();r?(s.setCache(e,{href:e,title:i,doc:r,html:o}),s.renderDoc(e),window.history.pushState(null,i,e),a.remove(),a=null,t.removeClass("docspress-single-ajax-loading")):window.location=e}else window.location=e},error:function(n){0!==n.status?console.log("error",n):window.location=e,t.removeClass("docspress-single-ajax-loading")}})}}}])&&e(o.prototype,t),s}();n((function(){new s}))})();